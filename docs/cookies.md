## Cookies

With [GDPR regulation](https://gdpr.eu/cookies/) in place for cookies, a lot has to be setup in order to comply with law.

At the most basic level, each cookie besides essencial ones (mostly our session cookie) has to be consented for by the user. Also a cookies policy page must be available with a description of the usage and origin of cookies that could possibly set on a given application.

In order to ease a bit that process the boilerplate is providing a bunch of helpers in the `helpers/gdpr_helper.rb` file. There, two things can be found:
- Obviously a series of view helpers related to cookies consents
- A cookie configuration step that allows to define which scripts and cookies should be loaded once the user has consented to it.

### Configuring scripts and cookies

Here's an example of the kind of configuration available:

```ruby
GdprConsent.configure do |config|
  config.add_script :asset_test, {
    asset: :asset_test,
    cookies: %w(asset_cookie),
    policies: {
      asset_cookie: {
        type: 'Non-essential (some purpose)',
        duration: 'Some duration',
        origin: 'First party',
        purpose: 'Some purpose explanation',
      },
    },
  }
  config.add_script :inline_test, {
    inline: 'document.cookie = "inline_cookie=foo";',
    cookies: %w(inline_cookie)
  }
  config.add_script :external_test, {
    url: '<path to the third party script>',
    cookies: %w(external_cookie)
  }

  config.add_policy :_boilerplate_session, {
    type: 'Essential (session management)',
    duration: 'Session',
    origin: 'First party',
    purpose: 'Stores session data during a session',
  }
end
```

In the example above three scripts are defined, each of them supposedly creating a cookie. Each will belong to a specific cookie categorie resulting in a specific opt-in in the consent banner.

You can also notice that a policy is defined for the app session cookie as well.

#### `add_script`

The signature of the `add_script` is as follow:

```ruby
def add_script(group, params)
```

|Arguments|Description|
|---|---|
|`group`|It identifies to which category the script/cookies belong to. The general categories that the GDPR defines are `necessary` for cookies required to operate the site (i.e. the cookie that stores a basket id for an e-commerce application), `functional` for cookies that may store user preferences in the form of a cookie, they're not required, then `performances` cookies generally refers to cookies from trafic trackers and analytics, and finally `marketing` cookies related to advertisement. Of course this is not an exhaustive list and you may want/need to define more categories depending on the context.|
|Parameters||
|`asset`|In case the script to load is part of the asset pipeline you can just provides the name of the asset just like you would do with rails assets methods.|
|`url`|The url of the third party script to load.|
|`inline`|In case the script to load is an inline snippet (typically analytic bootstrap), you can provide here the content for the generated `script` node.|
|`cookies`|An array containing the names of the cookies generated by the corresponding script, it serves both as a way to know which cookie to remove when consent for that script is turned off as well as providing informations for the policy page.|
|`policies`|An object where you can define policy information for each cookies that the given script creates, it include the `type` of cookie (the `group` but in human readable form), as well as its `duration`, `origin` and `purpose`.|

#### `add_policy`

A method used to define policy information for necessary cookies that aren't tied to a script, such as rails session cookie. It takes the cookie name as first parameter and then an object with the policy field as also defined in `add_script`.

### GDPR Helpers

#### `has_consent_cookie?`

Returns whether the user has passed the consent step when first accessing the website.

#### `consent_to?(type)`

Returns whether the user has consented to the specified cookies type.

#### `render_scripts`

Generates the `script` tags according to the user consents.

#### `render_scripts_config`

Generates a JSON object that contains the scripts configuration as defined in `GdprConsent.configure` and that can be consumed by the consent banner to generates the consent toggles as well as loading scripts and managing cookies.

#### `reject_all_payload`

Generate a JSON object that represents the payload for the *Reject all* choice.

#### `accept_all_payload`

Generate a JSON object that represents the payload for the *Accept all* choice.
